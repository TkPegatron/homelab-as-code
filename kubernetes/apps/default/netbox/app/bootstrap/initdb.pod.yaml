apiVersion: apps/v1
kind: Deployment
metadata:
  name: netbox-initdb-adhoc
  namespace: default
  annotations:
    reloader.stakater.com/auto: "true"
spec:
  replicas: 1
  strategy:
    type: RollingUpdate
  selector:
    # Editor complains if spec.selector is empty, despite using fancy kustomizations
  template:
    spec:
      containers:
        - name: initdb
          image: ghcr.io/onedr0p/postgres-initdb:14.7@sha256:0f218a74ad4323e843ce18c97805f32ae5ab514df751acc8caa030d6f2f038d5
          resources: {}
          command:
            - "/bin/bash"
            - "-c"
            - |
              /entrypoint.sh
              trap : TERM INT; sleep 9999999999d & wait
          env:
            - name: POSTGRES_HOST
              value: postgres-rw.default.svc.cluster.local
            - name: POSTGRES_DB
              value: netbox
            - name: POSTGRES_SUPER_PASS
              valueFrom:
                secretKeyRef:
                  name: cloudnative-pg-superuser-secret
                  key: password
            - name: POSTGRES_USER
              valueFrom:
                configMapKeyRef:
                  name: netbox
                  key: DB_USER
            - name: POSTGRES_PASS
              valueFrom:
                secretKeyRef:
                  name: netbox
                  key: DB_PASSWORD
